взяти визначення РМв1;

структура SqliteExecCallbackData {
  Р: адреса<РМв1::Розширення>;
  обʼєкт_рядків: адреса<РМв1::Обʼєкт>;
}

синонім SqliteExecCallback = (data: адреса<SqliteExecCallbackData>, argc: int, argv: памʼять<адреса<char>>, column_names: памʼять<адреса<char>>) -> int;
зовнішня дія sqlite_mavka_extension_open(path: адреса<char>, path_size: size_t, error_ptr: адреса<памʼять<char>>, error_size_ptr: адреса<size_t>): адреса;
зовнішня дія sqlite_mavka_extension_close(db: адреса);
зовнішня дія sqlite_mavka_extension_exec(db: адреса, sql: адреса<char>, sql_size: size_t, callback: SqliteExecCallback, data: адреса<SqliteExecCallbackData>, error_ptr: адреса<адреса<char>>, error_size_ptr: адреса<size_t>): int;
зовнішня дія sqlite_mavka_extension_prepare_v2(db: адреса, sql: адреса<char>, sql_size: size_t): адреса;
зовнішня дія sqlite_mavka_extension_bind_double(stmt: адреса, i: int, value: double): int;
зовнішня дія sqlite_mavka_extension_bind_int(stmt: адреса, i: int, value: int): int;
зовнішня дія sqlite_mavka_extension_bind_int64(stmt: адреса, i: int, value: long): int;
зовнішня дія sqlite_mavka_extension_bind_null(stmt: адреса, i: int): int;
зовнішня дія sqlite_mavka_extension_bind_text(stmt: адреса, i: int, value: памʼять<char>, value_size: size_t): int;
зовнішня дія sqlite_mavka_extension_expanded_sql(stmt: адреса, out: адреса<памʼять<п8>>): size_t;
зовнішня дія sqlite_mavka_extension_step(stmt: адреса): int;
зовнішня дія sqlite_mavka_extension_column_count(stmt: адреса): int;
зовнішня дія sqlite_mavka_extension_column_type(stmt: адреса, i: int): int;
зовнішня дія sqlite_mavka_extension_column_text(stmt: адреса, i: int, out: адреса<памʼять<char>>): size_t;
зовнішня дія sqlite_mavka_extension_column_int(stmt: адреса, i: int): int;
зовнішня дія sqlite_mavka_extension_column_double(stmt: адреса, i: int): double;
зовнішня дія sqlite_mavka_extension_finalize(stmt: адреса): int;

дія нативна_дія_open(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_шлях = ні;
  змінна ціль аргумент_шлях: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_шлях = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"шлях"), аргумент_шлях::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_шлях == ні {
      знайдено_аргумент_шлях = так;
      аргумент_шлях = аргументи[0];
    }
  }
  якщо знайдено_аргумент_шлях == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"шлях\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_юнікодом(аргумент_шлях, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"шлях\" має бути юнікодом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_шлях);
  ціль шлях_Ю8: памʼять<п8> = пусто;
  ціль розмір_шляху_Ю8 = РМв1::отримати_копію_даних_юнікоду_як_Ю8(аргумент_шлях, Р, шлях_Ю8::адреса);
  ціль open_error: памʼять<char> = пусто;
  ціль open_error_size: size_t = 0;
  ціль sqlite_db = sqlite_mavka_extension_open(шлях_Ю8 як адреса<char>, size_t(розмір_шляху_Ю8), open_error::адреса, open_error_size::адреса);
  РМв1::звільнити(Р, шлях_Ю8 як адреса);
  якщо open_error != пусто {
    вернути РМв1::падіння(Р, РМв1::створити_юнікод_з_Ю8(Р, open_error як памʼять<п8>));
  }
  вернути РМв1::успіх(Р, РМв1::створити_адресу(Р, sqlite_db));
}

дія exec_callback(data: адреса<SqliteExecCallbackData>, argc: int, argv: памʼять<адреса<char>>, column_names: памʼять<адреса<char>>): int {
  ціль Р = data.Р;
  ціль обʼєкт_рядків = data.обʼєкт_рядків;
  ціль рядок = РМв1::створити_словник(Р);
  РМв1::зберегти_обʼєкт(Р, обʼєкт_рядків);
  РМв1::зберегти_обʼєкт(Р, рядок);
  змінна ціль п: int = 0;
  поки п < argc {
    змінна ціль ключ = РМв1::створити_юнікод_з_Ю8(Р, column_names[п] як памʼять<п8>);
    змінна ціль значення = РМв1::створити_юнікод_з_Ю8(Р, argv[п] як памʼять<п8>);
    РМв1::зберегти_обʼєкт(Р, ключ);
    РМв1::зберегти_обʼєкт(Р, значення);
    ціль результат_зміни_елемента = РМв1::обʼєкт_змінити_елемент(рядок, Р, ключ, значення);
    РМв1::видалити_збережений_обʼєкт(Р);
    РМв1::видалити_збережений_обʼєкт(Р);
    п += 1;
  }
  ціль результат_отримання_довжини = РМв1::обʼєкт_отримати_властивість(обʼєкт_рядків, Р, РМв1::назва_з_Ю8(Р, ю8"довжина"));
  ціль довжина_д64 = РМв1::отримати_значення_числа(результат_отримання_довжини.значення, Р);
  ціль результат_зміни_елемента = РМв1::обʼєкт_змінити_елемент(обʼєкт_рядків, Р, РМв1::створити_число(Р, довжина_д64), рядок);
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  вернути 0;
}

дія нативна_дія_exec(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_db = ні;
  змінна ціль аргумент_db: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_sql = ні;
  змінна ціль аргумент_sql: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_db = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"db"), аргумент_db::адреса);
    знайдено_аргумент_sql = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"sql"), аргумент_sql::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_db == ні {
      знайдено_аргумент_db = так;
      аргумент_db = аргументи[0];
    }
    якщо кількість_аргументів > 1 {
      якщо знайдено_аргумент_sql == ні {
        знайдено_аргумент_sql = так;
        аргумент_sql = аргументи[1];
      }
    }
  }
  якщо знайдено_аргумент_db == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"db\""));
  }
  якщо знайдено_аргумент_sql == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"sql\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_db, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"db\" має бути адресою"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_юнікодом(аргумент_sql, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"sql\" має бути юнікодом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_db);
  РМв1::зберегти_обʼєкт(Р, аргумент_sql);
  ціль db = РМв1::отримати_значення_адреси(аргумент_db, Р);
  ціль sql: памʼять<п8> = пусто;
  ціль sql_size = РМв1::отримати_копію_даних_юнікоду_як_Ю8(аргумент_sql, Р, sql::адреса);
  змінна ціль error: памʼять<п8> = пусто;
  змінна ціль error_size: size_t = 0;
  ціль обʼєкт_рядків = РМв1::створити_список(Р);
  ціль data = РМв1::виділити<SqliteExecCallbackData>(Р);
  data.Р = Р;
  data.обʼєкт_рядків = обʼєкт_рядків;
  ціль success = sqlite_mavka_extension_exec(db, sql як адреса<char>, size_t(sql_size), exec_callback, data, error::адреса як адреса<адреса<char>>, error_size::адреса);
  РМв1::звільнити(Р, sql як адреса);
  РМв1::звільнити(Р, data як адреса);
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  якщо success == 0 {
    вернути РМв1::падіння(Р, РМв1::створити_юнікод_з_Ю8(Р, error));
  }
  вернути РМв1::успіх(Р, обʼєкт_рядків);
}

дія нативна_дія_prepare_v2(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_db = ні;
  змінна ціль аргумент_db: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_sql = ні;
  змінна ціль аргумент_sql: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_db = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"db"), аргумент_db::адреса);
    знайдено_аргумент_sql = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"sql"), аргумент_sql::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_db == ні {
      знайдено_аргумент_db = так;
      аргумент_db = аргументи[0];
    }
    якщо кількість_аргументів > 1 {
      якщо знайдено_аргумент_sql == ні {
        знайдено_аргумент_sql = так;
        аргумент_sql = аргументи[1];
      }
    }
  }
  якщо знайдено_аргумент_db == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"db\""));
  }
  якщо знайдено_аргумент_sql == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"sql\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_db, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"db\" має бути адресою"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_юнікодом(аргумент_sql, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"sql\" має бути юнікодом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_db);
  РМв1::зберегти_обʼєкт(Р, аргумент_sql);
  ціль db = РМв1::отримати_значення_адреси(аргумент_db, Р);
  ціль sql: памʼять<п8> = пусто;
  ціль sql_size = РМв1::отримати_копію_даних_юнікоду_як_Ю8(аргумент_sql, Р, sql::адреса);
  ціль prepared_stmt = sqlite_mavka_extension_prepare_v2(db, sql як адреса<char>, size_t(sql_size));
  РМв1::звільнити(Р, sql як адреса);
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  якщо prepared_stmt == пусто {
    вернути РМв1::падіння(Р, РМв1::створити_юнікод_з_Ю8(Р, ю8"cannot prepare stmt"));
  }
  вернути РМв1::успіх(Р, РМв1::створити_адресу(Р, prepared_stmt));
}

дія нативна_дія_bind_double(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_stmt = ні;
  змінна ціль аргумент_stmt: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_i = ні;
  змінна ціль аргумент_i: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_value = ні;
  змінна ціль аргумент_value: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_stmt = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"stmt"), аргумент_stmt::адреса);
    знайдено_аргумент_i = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"i"), аргумент_i::адреса);
    знайдено_аргумент_value = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"value"), аргумент_value::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_stmt == ні {
      знайдено_аргумент_stmt = так;
      аргумент_stmt = аргументи[0];
    }
    якщо кількість_аргументів > 1 {
      якщо знайдено_аргумент_i == ні {
        знайдено_аргумент_i = так;
        аргумент_i = аргументи[1];
      }
      якщо кількість_аргументів > 2 {
        якщо знайдено_аргумент_value == ні {
          знайдено_аргумент_value = так;
          аргумент_value = аргументи[2];
        }
      }
    }
  }
  якщо знайдено_аргумент_stmt == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"stmt\""));
  }
  якщо знайдено_аргумент_i == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"i\""));
  }
  якщо знайдено_аргумент_value == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"value\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_stmt, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"stmt\" має бути адресою"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_i, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"i\" має бути числом"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_value, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"value\" має бути числом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_stmt);
  РМв1::зберегти_обʼєкт(Р, аргумент_i);
  РМв1::зберегти_обʼєкт(Р, аргумент_value);
  ціль stmt = РМв1::отримати_значення_адреси(аргумент_stmt, Р);
  ціль i_значення_числа = РМв1::отримати_значення_числа(аргумент_i, Р);
  ціль value_значення_числа = РМв1::отримати_значення_числа(аргумент_value, Р);
  sqlite_mavka_extension_bind_double(stmt, int(i_значення_числа), double(value_значення_числа));
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  вернути РМв1::успіх(Р, пусто);
}

дія нативна_дія_bind_int(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_stmt = ні;
  змінна ціль аргумент_stmt: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_i = ні;
  змінна ціль аргумент_i: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_value = ні;
  змінна ціль аргумент_value: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_stmt = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"stmt"), аргумент_stmt::адреса);
    знайдено_аргумент_i = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"i"), аргумент_i::адреса);
    знайдено_аргумент_value = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"value"), аргумент_value::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_stmt == ні {
      знайдено_аргумент_stmt = так;
      аргумент_stmt = аргументи[0];
    }
    якщо кількість_аргументів > 1 {
      якщо знайдено_аргумент_i == ні {
        знайдено_аргумент_i = так;
        аргумент_i = аргументи[1];
      }
      якщо кількість_аргументів > 2 {
        якщо знайдено_аргумент_value == ні {
          знайдено_аргумент_value = так;
          аргумент_value = аргументи[2];
        }
      }
    }
  }
  якщо знайдено_аргумент_stmt == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"stmt\""));
  }
  якщо знайдено_аргумент_i == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"i\""));
  }
  якщо знайдено_аргумент_value == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"value\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_stmt, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"stmt\" має бути адресою"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_i, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"i\" має бути числом"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_value, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"value\" має бути числом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_stmt);
  РМв1::зберегти_обʼєкт(Р, аргумент_i);
  РМв1::зберегти_обʼєкт(Р, аргумент_value);
  ціль stmt = РМв1::отримати_значення_адреси(аргумент_stmt, Р);
  ціль i_значення_числа = РМв1::отримати_значення_числа(аргумент_i, Р);
  ціль value_значення_числа = РМв1::отримати_значення_числа(аргумент_value, Р);
  sqlite_mavka_extension_bind_int(stmt, int(i_значення_числа), int(value_значення_числа));
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  вернути РМв1::успіх(Р, пусто);
}

дія нативна_дія_bind_int64(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_stmt = ні;
  змінна ціль аргумент_stmt: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_i = ні;
  змінна ціль аргумент_i: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_value = ні;
  змінна ціль аргумент_value: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_stmt = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"stmt"), аргумент_stmt::адреса);
    знайдено_аргумент_i = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"i"), аргумент_i::адреса);
    знайдено_аргумент_value = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"value"), аргумент_value::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_stmt == ні {
      знайдено_аргумент_stmt = так;
      аргумент_stmt = аргументи[0];
    }
    якщо кількість_аргументів > 1 {
      якщо знайдено_аргумент_i == ні {
        знайдено_аргумент_i = так;
        аргумент_i = аргументи[1];
      }
      якщо кількість_аргументів > 2 {
        якщо знайдено_аргумент_value == ні {
          знайдено_аргумент_value = так;
          аргумент_value = аргументи[2];
        }
      }
    }
  }
  якщо знайдено_аргумент_stmt == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"stmt\""));
  }
  якщо знайдено_аргумент_i == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"i\""));
  }
  якщо знайдено_аргумент_value == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"value\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_stmt, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"stmt\" має бути адресою"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_i, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"i\" має бути числом"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_value, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"value\" має бути числом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_stmt);
  РМв1::зберегти_обʼєкт(Р, аргумент_i);
  РМв1::зберегти_обʼєкт(Р, аргумент_value);
  ціль stmt = РМв1::отримати_значення_адреси(аргумент_stmt, Р);
  ціль i_значення_числа = РМв1::отримати_значення_числа(аргумент_i, Р);
  ціль value_значення_числа = РМв1::отримати_значення_числа(аргумент_value, Р);
  sqlite_mavka_extension_bind_int64(stmt, int(i_значення_числа), long(value_значення_числа));
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  вернути РМв1::успіх(Р, пусто);
}

дія нативна_дія_bind_null(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_stmt = ні;
  змінна ціль аргумент_stmt: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_i = ні;
  змінна ціль аргумент_i: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_stmt = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"stmt"), аргумент_stmt::адреса);
    знайдено_аргумент_i = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"i"), аргумент_i::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_stmt == ні {
      знайдено_аргумент_stmt = так;
      аргумент_stmt = аргументи[0];
    }
    якщо кількість_аргументів > 1 {
      якщо знайдено_аргумент_i == ні {
        знайдено_аргумент_i = так;
        аргумент_i = аргументи[1];
      }
    }
  }
  якщо знайдено_аргумент_stmt == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"stmt\""));
  }
  якщо знайдено_аргумент_i == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"i\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_stmt, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"stmt\" має бути адресою"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_i, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"i\" має бути числом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_stmt);
  РМв1::зберегти_обʼєкт(Р, аргумент_i);
  ціль stmt = РМв1::отримати_значення_адреси(аргумент_stmt, Р);
  ціль i_значення_числа = РМв1::отримати_значення_числа(аргумент_i, Р);
  sqlite_mavka_extension_bind_null(stmt, int(i_значення_числа));
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  вернути РМв1::успіх(Р, пусто);
}

дія нативна_дія_bind_text(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_stmt = ні;
  змінна ціль аргумент_stmt: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_i = ні;
  змінна ціль аргумент_i: адреса<РМв1::Обʼєкт> = пусто;
  змінна ціль знайдено_аргумент_value = ні;
  змінна ціль аргумент_value: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_stmt = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"stmt"), аргумент_stmt::адреса);
    знайдено_аргумент_i = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"i"), аргумент_i::адреса);
    знайдено_аргумент_value = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"value"), аргумент_value::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_stmt == ні {
      знайдено_аргумент_stmt = так;
      аргумент_stmt = аргументи[0];
    }
    якщо кількість_аргументів > 1 {
      якщо знайдено_аргумент_i == ні {
        знайдено_аргумент_i = так;
        аргумент_i = аргументи[1];
      }
      якщо кількість_аргументів > 2 {
        якщо знайдено_аргумент_value == ні {
          знайдено_аргумент_value = так;
          аргумент_value = аргументи[2];
        }
      }
    }
  }
  якщо знайдено_аргумент_stmt == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"stmt\""));
  }
  якщо знайдено_аргумент_i == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"i\""));
  }
  якщо знайдено_аргумент_value == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"value\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_stmt, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"stmt\" має бути адресою"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_числом(аргумент_i, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"i\" має бути числом"));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_юнікодом(аргумент_value, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"value\" має бути юнікодом"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_stmt);
  РМв1::зберегти_обʼєкт(Р, аргумент_i);
  РМв1::зберегти_обʼєкт(Р, аргумент_value);
  ціль stmt = РМв1::отримати_значення_адреси(аргумент_stmt, Р);
  ціль i_значення_числа = РМв1::отримати_значення_числа(аргумент_i, Р);
  ціль value_значення_юнікоду: памʼять<п8> = пусто;
  ціль value_значення_юнікоду_size = РМв1::отримати_копію_даних_юнікоду_як_Ю8(аргумент_value, Р, value_значення_юнікоду::адреса);
  sqlite_mavka_extension_bind_text(stmt, int(i_значення_числа), value_значення_юнікоду як памʼять<char>, size_t(value_значення_юнікоду_size));
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  вернути РМв1::успіх(Р, пусто);
}

дія нативна_дія_expanded_sql(обʼєкт_нативної_дії: адреса<РМв1::Обʼєкт>, Р: адреса<РМв1::Розширення>, обʼєкт_я: адреса<РМв1::Обʼєкт>, кількість_аргументів: позитивне, аргументи: памʼять<адреса<РМв1::Обʼєкт>>, іменовані_аргументи: адреса<РМв1::ІменованіАргументи>, дані: адреса): РМв1::Результат {
  змінна ціль знайдено_аргумент_stmt = ні;
  змінна ціль аргумент_stmt: адреса<РМв1::Обʼєкт> = пусто;
  якщо іменовані_аргументи != пусто {
    знайдено_аргумент_stmt = РМв1::знайти_іменований_аргумент(Р, іменовані_аргументи, РМв1::назва_з_Ю8(Р, ю8"stmt"), аргумент_stmt::адреса);
  }
  якщо кількість_аргументів > 0 {
    якщо знайдено_аргумент_stmt == ні {
      знайдено_аргумент_stmt = так;
      аргумент_stmt = аргументи[0];
    }
  }
  якщо знайдено_аргумент_stmt == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Пропущено аргумент \"stmt\""));
  }
  якщо РМв1::перевірити_чи_обʼєкт_є_адресою(аргумент_stmt, Р) == ні {
    вернути РМв1::падіння(Р, РМв1::створити_текст_з_Ю8(Р, ю8"Аргумент \"stmt\" має бути адресою"));
  }
  РМв1::зберегти_обʼєкт(Р, аргумент_stmt);
  ціль stmt = РМв1::отримати_значення_адреси(аргумент_stmt, Р);
  РМв1::видалити_збережений_обʼєкт(Р);
  ціль expanded_sql: памʼять<п8> = пусто;
  ціль розмір_expanded_sql = sqlite_mavka_extension_expanded_sql(stmt, expanded_sql::адреса);
  вернути РМв1::успіх(Р, РМв1::створити_юнікод_з_Ю8(Р, expanded_sql));
}

зовнішня дія завантажити_РМв1(Р: адреса<РМв1::Розширення>): РМв1::Результат {
  ціль обʼєкт_модуля_sqlite3 = РМв1::створити_модуль(Р, РМв1::назва_з_Ю8(Р, ю8"sqlite3"));
  РМв1::зберегти_обʼєкт(Р, обʼєкт_модуля_sqlite3);
  ціль обʼєкт_нативної_дії_open = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"open"), нативна_дія_open, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"open"), обʼєкт_нативної_дії_open);
  ціль обʼєкт_нативної_дії_exec = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"exec"), нативна_дія_exec, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"exec"), обʼєкт_нативної_дії_exec);
  ціль обʼєкт_нативної_дії_prepare_v2 = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"prepare_v2"), нативна_дія_prepare_v2, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"prepare_v2"), обʼєкт_нативної_дії_prepare_v2);
  ціль обʼєкт_нативної_дії_bind_double = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"bind_double"), нативна_дія_bind_double, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"bind_double"), обʼєкт_нативної_дії_bind_double);
  ціль обʼєкт_нативної_дії_bind_int = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"bind_int"), нативна_дія_bind_int, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"bind_int"), обʼєкт_нативної_дії_bind_int);
  ціль обʼєкт_нативної_дії_bind_int64 = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"bind_int64"), нативна_дія_bind_int64, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"bind_int64"), обʼєкт_нативної_дії_bind_int64);
  ціль обʼєкт_нативної_дії_bind_null = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"bind_null"), нативна_дія_bind_null, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"bind_null"), обʼєкт_нативної_дії_bind_null);
  ціль обʼєкт_нативної_дії_bind_text = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"bind_text"), нативна_дія_bind_text, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"bind_text"), обʼєкт_нативної_дії_bind_text);
  ціль обʼєкт_нативної_дії_expanded_sql = РМв1::створити_нативну_дію(Р, РМв1::назва_з_Ю8(Р, ю8"expanded_sql"), нативна_дія_expanded_sql, пусто, пусто);
  РМв1::обʼєкт_змінити_властивість(обʼєкт_модуля_sqlite3, Р, РМв1::назва_з_Ю8(Р, ю8"expanded_sql"), обʼєкт_нативної_дії_expanded_sql);
  РМв1::видалити_збережений_обʼєкт(Р);
  вернути РМв1::успіх(Р, обʼєкт_модуля_sqlite3);
}